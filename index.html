<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <title>KartAppeal – Apelações de Karting com IA</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root{--cor:#0057e6;--fundo:#f6f9ff}
    body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial;margin:0;background:var(--fundo);color:#222}
    header{background:var(--cor);color:#fff;padding:3rem 1rem;text-align:center}
    .hero{width:100%;max-width:700px;margin:-2rem auto 2rem;display:block;border-radius:12px;box-shadow:0 8px 25px rgba(0,0,0,.15)}
    main{max-width:600px;margin:0 auto 3rem;padding:0 1rem}
    form{background:#fff;padding:2rem;border-radius:12px;box-shadow:0 4px 20px rgba(0,0,0,.08)}
    label,input{display:block;width:100%;margin-bottom:1rem}
    input{padding:.75rem;border:1px solid #ccc;border-radius:6px;font-size:1rem}
    button{background:var(--cor);color:#fff;border:none;padding:.9rem 1.5rem;font-size:1.1rem;border-radius:6px;cursor:pointer;width:100%}
    button:disabled{opacity:.6}
    #resposta{background:#fff;padding:1.5rem;border-radius:12px;box-shadow:0 4px 20px rgba(0,0,0,.08);white-space:pre-wrap}
  </style>
</head>
<body>
  <header>
    <h1>KartAppeal</h1>
    <p>Descreva a penalidade e receba instantaneamente a análise com base nos 22 regulamentos.</p>
  </header>
  <img src="https://images.unsplash.com/photo-1622484446431-e4592de4a7ba?auto=format&fit=crop&w=1200&q=80" alt="Kart" class="hero">

  <main>
    <form id="form" onsubmit="enviar(event)">
      <label>Penalidade recebida
        <input type="text" id="penalidade" placeholder="Ex.: 10 s por toque no kart #5" required>
      </label>
      <label>Seu e-mail (cópia opcional)
        <input type="email" id="email" placeholder="seu@email.com">
      </label>
      <button type="submit">Analisar</button>
    </form>
    <div id="resposta" style="display:none;"></div>
  </main>

  <script>
    async function enviar(e) {
      e.preventDefault();
      const btn = e.target.querySelector('button');
      const res = document.getElementById('resposta');
      btn.disabled = true;
      btn.textContent = 'Analisando...';
      res.style.display = 'block';
      res.textContent = 'Aguarde...';

      const pen = document.getElementById('penalidade').value;
      const mail = document.getElementById('email').value || 'no-reply@example.com';

      // 1. Dispara a Action
     const token = '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'; // substitua pelo valor real ou use proxy
      await fetch('https://api.github.com/repos/rodrigoisolago/kart-appeal/actions/workflows/analise.yml/dispatches', {
        method: 'POST',
        headers: {
          'Accept': 'application/vnd.github+json',
          'Authorization': `Bearer ${token}`,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ ref: 'main', inputs: { penalidade: pen, email: mail } })
      });

      // 2. Aguarda o JSON aparecer
      const ts = new Date().toISOString().slice(0, 19).replace(/:/g, '-').slice(0, -3);
      const jsonUrl = `https://raw.githubusercontent.com/rodrigoisolago/kart-appeal/main/resultados/${ts}.json`;
      let tentativas = 0;
      const max = 30;
      const interval = setInterval(async () => {
        try {
          const r = await fetch(jsonUrl);
          if (r.ok) {
            const data = await r.json();
            res.textContent = data.analise;
            clearInterval(interval);
            btn.disabled = false;
            btn.textContent = 'Analisar';
            return;
          }
        } catch {}
        tentativas++;
        if (tentativas >= max) {
          clearInterval(interval);
          res.textContent = 'Erro: tempo limite. Tente novamente.';
          btn.disabled = false;
          btn.textContent = 'Analisar';
        }
      }, 2000);
    }
  </script>
</body>
</html>
